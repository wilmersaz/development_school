<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manejo de Errores en Fetch API</title>
  <link rel="shortcut icon" href="../images/school.png" type="image/x-icon">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
    }

    @keyframes slideIn {
      from {
        transform: translateX(-100%);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .slide-in {
      animation: slideIn 0.8s ease-out forwards;
    }

    @keyframes typewriter {
      from {
        width: 0
      }

      to {
        width: 100%
      }
    }

    .typewriter {
      overflow: hidden;
      border-right: .15em solid #dc2626;
      white-space: nowrap;
      margin: 0 auto;
      animation: typewriter 3s steps(40, end);
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .fade-in-up {
      animation: fadeInUp 0.8s ease-out forwards;
    }

    @keyframes shake {

      0%,
      100% {
        transform: translateX(0);
      }

      25% {
        transform: translateX(-5px);
      }

      75% {
        transform: translateX(5px);
      }
    }

    .shake {
      animation: shake 0.5s ease-in-out;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.7;
      }
    }

    .pulse-animation {
      animation: pulse 2s infinite;
    }

    .error-demo {
      border: 2px solid #dc2626;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .error-demo:hover {
      box-shadow: 0 0 20px rgba(220, 38, 38, 0.3);
      transform: translateY(-2px);
    }

    .success-demo {
      border: 2px solid #16a34a;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .success-demo:hover {
      box-shadow: 0 0 20px rgba(22, 163, 74, 0.3);
      transform: translateY(-2px);
    }
  </style>
</head>

<body class="min-h-screen py-8">
  <!-- Navigation -->
  <nav class="mb-8">
    <div class="max-w-6xl mx-auto px-4 flex flex-col gap-3 sm:flex-row sm:justify-between sm:items-center">
      <a href="manejo-respuestas.html"
        class="bg-white text-red-600 px-4 py-2 rounded-lg hover:bg-red-50 transition-colors w-full sm:w-auto text-center">
        ‚Üê Manejo de Respuestas
      </a>
      <div class="bg-gray-300 text-gray-500 px-4 py-2 rounded-lg opacity-50 text-center">
        (√öltimo tema)
      </div>
    </div>
  </nav>

  <div class="container mx-auto px-4 max-w-6xl">

    <!-- Header -->
    <header class="text-center mb-12">
      <h1 class="text-5xl font-bold text-white mb-4 typewriter">
        üö® Manejo de Errores en Fetch API
      </h1>
      <p class="text-xl text-red-100 fade-in-up">
        Aprende a manejar errores de manera efectiva y crear aplicaciones robustas
      </p>
    </header>

    <!-- Introducci√≥n -->
    <section class="mb-12">
      <div class="bg-white bg-opacity-10 backdrop-blur-md rounded-xl p-8 slide-in">
        <h2 class="text-3xl font-bold text-white mb-6 flex items-center">
          <span class="mr-3">üéØ</span> ¬øPor qu√© es importante el manejo de errores?
        </h2>
        <div class="grid md:grid-cols-2 gap-6">
          <div class="bg-red-500 p-6 rounded-lg">
            <h3 class="text-xl font-semibold text-white mb-3">‚ùå Sin manejo de errores</h3>
            <ul class="text-red-100 space-y-2">
              <li>‚Ä¢ La aplicaci√≥n se rompe inesperadamente</li>
              <li>‚Ä¢ Experiencia de usuario frustrante</li>
              <li>‚Ä¢ Dif√≠cil de debuggear problemas</li>
              <li>‚Ä¢ No hay retroalimentaci√≥n al usuario</li>
            </ul>
          </div>
          <div class="bg-green-500 p-6 rounded-lg">
            <h3 class="text-xl font-semibold text-white mb-3">‚úÖ Con manejo de errores</h3>
            <ul class="text-green-100 space-y-2">
              <li>‚Ä¢ Aplicaci√≥n estable y confiable</li>
              <li>‚Ä¢ Mejor experiencia de usuario</li>
              <li>‚Ä¢ F√°cil identificaci√≥n de problemas</li>
              <li>‚Ä¢ Mensajes informativos y √∫tiles</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Tipos de errores -->
    <section class="mb-12">
      <div class="bg-white bg-opacity-10 backdrop-blur-md rounded-xl p-8 fade-in-up">
        <h2 class="text-3xl font-bold text-white mb-6 flex items-center">
          <span class="mr-3">‚ö†Ô∏è</span> Tipos de errores en Fetch API
        </h2>
        <div class="grid md:grid-cols-3 gap-6">
          <div class="bg-orange-500 p-6 rounded-lg">
            <h3 class="text-xl font-semibold text-white mb-3">üåê Errores de Red</h3>
            <ul class="text-orange-100 space-y-2 text-sm">
              <li>‚Ä¢ Sin conexi√≥n a internet</li>
              <li>‚Ä¢ Servidor no disponible</li>
              <li>‚Ä¢ Timeout de conexi√≥n</li>
              <li>‚Ä¢ DNS no resuelve</li>
            </ul>
          </div>
          <div class="bg-red-500 p-6 rounded-lg">
            <h3 class="text-xl font-semibold text-white mb-3">üìÑ Errores HTTP</h3>
            <ul class="text-red-100 space-y-2 text-sm">
              <li>‚Ä¢ 404 - No encontrado</li>
              <li>‚Ä¢ 401 - No autorizado</li>
              <li>‚Ä¢ 500 - Error del servidor</li>
              <li>‚Ä¢ 403 - Prohibido</li>
            </ul>
          </div>
          <div class="bg-purple-500 p-6 rounded-lg">
            <h3 class="text-xl font-semibold text-white mb-3">üíª Errores de C√≥digo</h3>
            <ul class="text-purple-100 space-y-2 text-sm">
              <li>‚Ä¢ JSON malformado</li>
              <li>‚Ä¢ Tipos de datos incorrectos</li>
              <li>‚Ä¢ Referencias undefined</li>
              <li>‚Ä¢ Errores de sintaxis</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Try-Catch b√°sico -->
    <section class="mb-12">
      <div class="bg-white bg-opacity-10 backdrop-blur-md rounded-xl p-8 fade-in-up">
        <h2 class="text-3xl font-bold text-white mb-6 flex items-center">
          <span class="mr-3">üõ°Ô∏è</span> Try-Catch B√°sico
        </h2>
        <div class="bg-gray-900 rounded-lg p-6 mb-6">
          <pre class="text-green-400 text-sm overflow-x-auto"><code>// ‚ùå Sin manejo de errores - PELIGROSO
async function fetchDataWrong() {
  const response = await fetch('https://api.example.com/data');
  const data = await response.json();
  return data; // Si falla, la app se rompe
}

// ‚úÖ Con manejo de errores - SEGURO
async function fetchDataSafe() {
  try {
    const response = await fetch('https://api.example.com/data');
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const data = await response.json();
    return data;
    
  } catch (error) {
    console.error('Error fetching data:', error);
    throw error; // Re-lanzar para que el llamador pueda manejarlo
  }
}</code></pre>
        </div>

        <div class="grid md:grid-cols-2 gap-6">
          <button onclick="demoBasicError()"
            class="error-demo bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition-all duration-300">
            üö® Probar Error de Red
          </button>
          <button onclick="demoBasicSuccess()"
            class="success-demo bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition-all duration-300">
            ‚úÖ Probar Petici√≥n Exitosa
          </button>
        </div>

        <div id="basicResult" class="mt-6 p-4 rounded-lg hidden"></div>
      </div>
    </section>

    <!-- Manejo espec√≠fico de c√≥digos HTTP -->
    <section class="mb-12">
      <div class="bg-white bg-opacity-10 backdrop-blur-md rounded-xl p-8 fade-in-up">
        <h2 class="text-3xl font-bold text-white mb-6 flex items-center">
          <span class="mr-3">üî¢</span> Manejo de C√≥digos de Estado HTTP
        </h2>
        <div class="bg-gray-900 rounded-lg p-6 mb-6">
          <pre class="text-green-400 text-sm overflow-x-auto"><code>async function handleHttpErrors(url) {
  try {
    const response = await fetch(url);
    
    // Manejo espec√≠fico por c√≥digo de estado
    switch (response.status) {
      case 200:
      case 201:
        return await response.json();
        
      case 400:
        throw new Error('Solicitud inv√°lida - Revisa los datos enviados');
        
      case 401:
        throw new Error('No autorizado - Inicia sesi√≥n nuevamente');
        
      case 403:
        throw new Error('Prohibido - No tienes permisos para esta acci√≥n');
        
      case 404:
        throw new Error('Recurso no encontrado - Verifica la URL');
        
      case 429:
        throw new Error('Demasiadas peticiones - Intenta m√°s tarde');
        
      case 500:
        throw new Error('Error del servidor - Intenta m√°s tarde');
        
      default:
        throw new Error(`Error HTTP: ${response.status} - ${response.statusText}`);
    }
    
  } catch (error) {
    if (error instanceof TypeError) {
      throw new Error('Error de conexi√≥n - Verifica tu internet');
    }
    throw error;
  }
}</code></pre>
        </div>

        <div class="grid md:grid-cols-4 gap-4">
          <button onclick="demoHttpError(404)"
            class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded transition-all duration-300">
            404 Error
          </button>
          <button onclick="demoHttpError(401)"
            class="bg-orange-600 hover:bg-orange-700 text-white font-bold py-2 px-4 rounded transition-all duration-300">
            401 Error
          </button>
          <button onclick="demoHttpError(500)"
            class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded transition-all duration-300">
            500 Error
          </button>
          <button onclick="demoNetworkError()"
            class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded transition-all duration-300">
            Red Error
          </button>
        </div>

        <div id="httpResult" class="mt-6 p-4 rounded-lg hidden"></div>
      </div>
    </section>

    <!-- Retry y Timeout -->
    <section class="mb-12">
      <div class="bg-white bg-opacity-10 backdrop-blur-md rounded-xl p-8 fade-in-up">
        <h2 class="text-3xl font-bold text-white mb-6 flex items-center">
          <span class="mr-3">üîÑ</span> Reintentos y Timeouts
        </h2>
        <div class="bg-gray-900 rounded-lg p-6 mb-6">
          <pre class="text-green-400 text-sm overflow-x-auto"><code>// Funci√≥n con reintentos autom√°ticos
async function fetchWithRetry(url, options = {}, maxRetries = 3) {
  const { timeout = 5000, ...fetchOptions } = options;
  
  for (let attempt = 1; attempt <= maxRetries; attempt++) {
    try {
      console.log(`Intento ${attempt} de ${maxRetries}`);
      
      // Crear AbortController para timeout
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), timeout);
      
      const response = await fetch(url, {
        ...fetchOptions,
        signal: controller.signal
      });
      
      clearTimeout(timeoutId);
      
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }
      
      return await response.json();
      
    } catch (error) {
      console.error(`Intento ${attempt} fall√≥:`, error.message);
      
      // Si es el √∫ltimo intento, lanzar el error
      if (attempt === maxRetries) {
        throw new Error(`Fall√≥ despu√©s de ${maxRetries} intentos: ${error.message}`);
      }
      
      // Esperar antes del siguiente intento (backoff exponencial)
      const delay = Math.pow(2, attempt) * 1000; // 2s, 4s, 8s...
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }
}</code></pre>
        </div>

        <div class="grid md:grid-cols-2 gap-6">
          <button onclick="demoRetry()"
            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-all duration-300">
            üîÑ Probar Reintentos
          </button>
          <button onclick="demoTimeout()"
            class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg transition-all duration-300">
            ‚è±Ô∏è Probar Timeout
          </button>
        </div>

        <div id="retryResult" class="mt-6 p-4 rounded-lg hidden"></div>
      </div>
    </section>

    <!-- UI/UX para errores -->
    <section class="mb-12">
      <div class="bg-white bg-opacity-10 backdrop-blur-md rounded-xl p-8 fade-in-up">
        <h2 class="text-3xl font-bold text-white mb-6 flex items-center">
          <span class="mr-3">üé®</span> UI/UX para Manejo de Errores
        </h2>

        <div class="grid md:grid-cols-2 gap-8">
          <!-- Estados de carga -->
          <div>
            <h3 class="text-xl font-semibold text-white mb-4">Estados de la aplicaci√≥n</h3>
            <div class="space-y-4">
              <div class="bg-blue-500 p-4 rounded-lg">
                <div class="flex items-center">
                  <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-white mr-3"></div>
                  <span class="text-white">Cargando datos...</span>
                </div>
              </div>

              <div class="bg-red-500 p-4 rounded-lg">
                <div class="flex items-center">
                  <span class="text-2xl mr-3">‚ö†Ô∏è</span>
                  <div>
                    <p class="text-white font-semibold">Error de conexi√≥n</p>
                    <p class="text-red-200 text-sm">No se pudo conectar al servidor</p>
                  </div>
                </div>
              </div>

              <div class="bg-green-500 p-4 rounded-lg">
                <div class="flex items-center">
                  <span class="text-2xl mr-3">‚úÖ</span>
                  <span class="text-white">Datos cargados correctamente</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Ejemplo pr√°ctico -->
          <div>
            <h3 class="text-xl font-semibold text-white mb-4">Demo interactivo</h3>
            <div class="bg-gray-900 rounded-lg p-4">
              <button onclick="demoUIStates()"
                class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded mb-4 transition-all duration-300">
                Simular carga con errores
              </button>

              <div id="uiDemo" class="min-h-[100px] flex items-center justify-center">
                <span class="text-gray-400">Haz clic para comenzar la demo</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Mejores pr√°cticas -->
    <section class="mb-12">
      <div class="bg-red-500 backdrop-blur-md rounded-xl p-8 fade-in-up">
        <h2 class="text-3xl font-bold text-white mb-6 flex items-center">
          <span class="mr-3">üí°</span> Mejores Pr√°cticas
        </h2>

        <div class="grid md:grid-cols-2 gap-8">
          <div>
            <h3 class="text-xl font-semibold text-white mb-4 text-green-400">‚úÖ Hacer</h3>
            <ul class="space-y-3 text-green-100">
              <li class="flex items-start">
                <span class="text-green-400 mr-2">‚Ä¢</span>
                <span>Siempre usar try-catch con async/await</span>
              </li>
              <li class="flex items-start">
                <span class="text-green-400 mr-2">‚Ä¢</span>
                <span>Verificar response.ok antes de procesar</span>
              </li>
              <li class="flex items-start">
                <span class="text-green-400 mr-2">‚Ä¢</span>
                <span>Proporcionar mensajes de error √∫tiles</span>
              </li>
              <li class="flex items-start">
                <span class="text-green-400 mr-2">‚Ä¢</span>
                <span>Implementar estados de carga</span>
              </li>
              <li class="flex items-start">
                <span class="text-green-400 mr-2">‚Ä¢</span>
                <span>Usar timeouts para evitar esperas infinitas</span>
              </li>
              <li class="flex items-start">
                <span class="text-green-400 mr-2">‚Ä¢</span>
                <span>Logs detallados para debugging</span>
              </li>
            </ul>
          </div>

          <div>
            <h3 class="text-xl font-semibold text-white mb-4 text-red-400">‚ùå No hacer</h3>
            <ul class="space-y-3 text-red-100">
              <li class="flex items-start">
                <span class="text-red-400 mr-2">‚Ä¢</span>
                <span>Ignorar errores silenciosamente</span>
              </li>
              <li class="flex items-start">
                <span class="text-red-400 mr-2">‚Ä¢</span>
                <span>Mostrar stack traces al usuario</span>
              </li>
              <li class="flex items-start">
                <span class="text-red-400 mr-2">‚Ä¢</span>
                <span>Reintentos infinitos sin l√≠mite</span>
              </li>
              <li class="flex items-start">
                <span class="text-red-400 mr-2">‚Ä¢</span>
                <span>Manejar todos los errores igual</span>
              </li>
              <li class="flex items-start">
                <span class="text-red-400 mr-2">‚Ä¢</span>
                <span>Bloquear la UI sin feedback</span>
              </li>
              <li class="flex items-start">
                <span class="text-red-400 mr-2">‚Ä¢</span>
                <span>Exponer informaci√≥n sensible en errores</span>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Ejemplo completo -->
    <section class="mb-12">
      <div class="bg-white bg-opacity-10 backdrop-blur-md rounded-xl p-8 fade-in-up">
        <h2 class="text-3xl font-bold text-white mb-6 flex items-center">
          <span class="mr-3">üèÜ</span> Ejemplo Completo: Sistema Robusto
        </h2>

        <div class="bg-gray-900 rounded-lg p-6 mb-6">
          <pre class="text-green-400 text-sm overflow-x-auto"><code>class APIClient {
  constructor(baseURL, options = {}) {
    this.baseURL = baseURL;
    this.defaultOptions = {
      timeout: 10000,
      retries: 3,
      headers: { 'Content-Type': 'application/json' },
      ...options
    };
  }

  async request(endpoint, options = {}) {
    const url = `${this.baseURL}${endpoint}`;
    const config = { ...this.defaultOptions, ...options };
    
    return this.fetchWithRetry(url, config);
  }

  async fetchWithRetry(url, options) {
    const { retries, timeout, ...fetchOptions } = options;
    let lastError;

    for (let i = 0; i <= retries; i++) {
      try {
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), timeout);

        const response = await fetch(url, {
          ...fetchOptions,
          signal: controller.signal
        });

        clearTimeout(timeoutId);
        return this.handleResponse(response);

      } catch (error) {
        lastError = error;
        
        if (i < retries && this.isRetryableError(error)) {
          await this.delay(Math.pow(2, i) * 1000);
          continue;
        }
        break;
      }
    }

    throw this.createUserFriendlyError(lastError);
  }

  async handleResponse(response) {
    if (!response.ok) {
      const errorData = await response.json().catch(() => ({}));
      throw new HTTPError(response.status, response.statusText, errorData);
    }
    return response.json();
  }

  isRetryableError(error) {
    return error.name === 'AbortError' || 
           error instanceof TypeError ||
           (error instanceof HTTPError && error.status >= 500);
  }

  createUserFriendlyError(error) {
    if (error.name === 'AbortError') {
      return new Error('La petici√≥n tard√≥ demasiado. Intenta de nuevo.');
    }
    if (error instanceof TypeError) {
      return new Error('Error de conexi√≥n. Verifica tu internet.');
    }
    if (error instanceof HTTPError) {
      return new Error(this.getHTTPErrorMessage(error.status));
    }
    return error;
  }

  getHTTPErrorMessage(status) {
    const messages = {
      400: 'Solicitud inv√°lida',
      401: 'Necesitas iniciar sesi√≥n',
      403: 'No tienes permisos para esta acci√≥n',
      404: 'Recurso no encontrado',
      429: 'Demasiadas peticiones. Intenta m√°s tarde.',
      500: 'Error del servidor. Intenta m√°s tarde.'
    };
    return messages[status] || `Error del servidor (${status})`;
  }

  delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
}

class HTTPError extends Error {
  constructor(status, statusText, data) {
    super(`HTTP ${status}: ${statusText}`);
    this.status = status;
    this.statusText = statusText;
    this.data = data;
  }
}</code></pre>
        </div>

        <button onclick="demoCompleteSystem()"
          class="w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold py-3 px-6 rounded-lg transition-all duration-300">
          üöÄ Probar Sistema Completo
        </button>

        <div id="completeResult" class="mt-6 p-4 rounded-lg hidden"></div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="text-center">
      <div class="bg-red-500 backdrop-blur-md rounded-xl p-8">
        <h2 class="text-2xl font-bold text-white mb-4">üéì ¬°Felicitaciones!</h2>
        <p class="text-lg text-red-100 mb-6">
          Ahora sabes c√≥mo crear aplicaciones web robustas y resistentes a errores
        </p>
        <div class="flex flex-wrap justify-center gap-4">
          <span class="bg-red-500 bg-opacity-30 px-4 py-2 rounded-full text-white">Try-Catch</span>
          <span class="bg-red-500 bg-opacity-30 px-4 py-2 rounded-full text-white">Reintentos</span>
          <span class="bg-red-500 bg-opacity-30 px-4 py-2 rounded-full text-white">Timeouts</span>
          <span class="bg-red-500 bg-opacity-30 px-4 py-2 rounded-full text-white">UX Amigable</span>
          <span class="bg-red-500 bg-opacity-30 px-4 py-2 rounded-full text-white">Logging</span>
        </div>
      </div>
          <div class="text-center mt-8">
      <p class="text-white text-lg">
        üìñ Preparado para la clase de <strong>JavaScript - Manejo de Errores</strong>
      </p>
      <p class="text-red-100 mt-2">
        CCL ¬© Copyright 2025
      </p>
    </div>
    </footer>

  </div>

  <script>
    // Utilidades
    function showResult(elementId, message, type = 'info') {
      const element = document.getElementById(elementId);
      element.className = `mt-6 p-4 rounded-lg ${getResultClass(type)}`;
      element.innerHTML = message;
      element.classList.remove('hidden');
    }

    function getResultClass(type) {
      const classes = {
        success: 'bg-green-500 border border-green-500 text-green-100',
        error: 'bg-red-500 border border-red-500 text-red-100',
        warning: 'bg-yellow-500 border border-yellow-500 text-yellow-100',
        info: 'bg-blue-500 border border-blue-500 text-blue-100'
      };
      return classes[type] || classes.info;
    }

    // Demo b√°sico
    async function demoBasicError() {
      showResult('basicResult', '‚è≥ Intentando conectar a una URL inv√°lida...', 'info');

      try {
        const response = await fetch('https://invalid-url-that-will-fail.com/api/data');
        const data = await response.json();
        showResult('basicResult', '‚úÖ Datos recibidos: ' + JSON.stringify(data), 'success');
      } catch (error) {
        showResult('basicResult', `‚ùå <strong>Error capturado:</strong><br>
          <code>${error.message}</code><br><br>
          üõ°Ô∏è <strong>La aplicaci√≥n sigue funcionando</strong> gracias al try-catch`, 'error');
      }
    }

    async function demoBasicSuccess() {
      showResult('basicResult', '‚è≥ Obteniendo datos de una API real...', 'info');

      try {
        const response = await fetch('https://jsonplaceholder.typicode.com/posts/1');

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        showResult('basicResult', `‚úÖ <strong>√âxito!</strong><br>
          <strong>T√≠tulo:</strong> ${data.title}<br>
          <strong>Usuario ID:</strong> ${data.userId}`, 'success');
      } catch (error) {
        showResult('basicResult', `‚ùå Error: ${error.message}`, 'error');
      }
    }

    // Demo HTTP errors
    async function demoHttpError(statusCode) {
      showResult('httpResult', `‚è≥ Simulando error HTTP ${statusCode}...`, 'info');

      try {
        const response = await fetch(`https://httpstat.us/${statusCode}`);

        if (!response.ok) {
          const errorMessage = getHTTPErrorMessage(response.status);
          throw new Error(errorMessage);
        }

        const data = await response.text();
        showResult('httpResult', `‚úÖ ${data}`, 'success');
      } catch (error) {
        showResult('httpResult', `‚ùå <strong>Error HTTP ${statusCode}:</strong><br>
          ${error.message}<br><br>
          üí° Mensaje amigable para el usuario`, 'error');
      }
    }

    async function demoNetworkError() {
      showResult('httpResult', '‚è≥ Simulando error de red...', 'info');

      try {
        const controller = new AbortController();
        setTimeout(() => controller.abort(), 100); // Abort muy r√°pido

        const response = await fetch('https://jsonplaceholder.typicode.com/posts/1', {
          signal: controller.signal
        });

        const data = await response.json();
        showResult('httpResult', '‚úÖ Datos recibidos', 'success');
      } catch (error) {
        if (error.name === 'AbortError') {
          showResult('httpResult', `‚ùå <strong>Error de red simulado:</strong><br>
            Conexi√≥n abortada<br><br>
            üí° En una app real, esto podr√≠a ser falta de internet`, 'error');
        } else {
          showResult('httpResult', `‚ùå Error: ${error.message}`, 'error');
        }
      }
    }

    function getHTTPErrorMessage(status) {
      const messages = {
        400: 'Solicitud inv√°lida - Revisa los datos enviados',
        401: 'No autorizado - Inicia sesi√≥n nuevamente',
        403: 'Prohibido - No tienes permisos para esta acci√≥n',
        404: 'Recurso no encontrado - Verifica la URL',
        429: 'Demasiadas peticiones - Intenta m√°s tarde',
        500: 'Error del servidor - Intenta m√°s tarde'
      };
      return messages[status] || `Error HTTP: ${status}`;
    }

    // Demo retry
    async function demoRetry() {
      showResult('retryResult', '‚è≥ Iniciando sistema de reintentos...', 'info');

      let attempt = 0;
      const maxRetries = 3;

      async function attemptFetch() {
        attempt++;
        showResult('retryResult', `üîÑ Intento ${attempt} de ${maxRetries}...`, 'info');

        // Simular fallo en los primeros 2 intentos
        if (attempt < 3) {
          await new Promise(resolve => setTimeout(resolve, 1000));
          throw new Error(`Fallo simulado en intento ${attempt}`);
        }

        return { success: true, message: 'Datos obtenidos exitosamente' };
      }

      try {
        for (let i = 1; i <= maxRetries; i++) {
          try {
            const result = await attemptFetch();
            showResult('retryResult', `‚úÖ <strong>√âxito en intento ${attempt}!</strong><br>
              ${result.message}<br><br>
              üí° Los reintentos autom√°ticos mejoran la robustez`, 'success');
            return;
          } catch (error) {
            if (i === maxRetries) {
              throw new Error(`Fall√≥ despu√©s de ${maxRetries} intentos: ${error.message}`);
            }

            const delay = Math.pow(2, i) * 1000;
            showResult('retryResult', `‚ùå Intento ${i} fall√≥. Reintentando en ${delay / 1000}s...`, 'warning');
            await new Promise(resolve => setTimeout(resolve, delay));
          }
        }
      } catch (error) {
        showResult('retryResult', `‚ùå <strong>Error final:</strong><br>${error.message}`, 'error');
      }
    }

    async function demoTimeout() {
      showResult('retryResult', '‚è≥ Probando timeout (5 segundos m√°ximo)...', 'info');

      try {
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 5000);

        // Simular una petici√≥n muy lenta (10 segundos)
        const response = await fetch('https://httpstat.us/200?sleep=10000', {
          signal: controller.signal
        });

        clearTimeout(timeoutId);
        showResult('retryResult', '‚úÖ Petici√≥n completada', 'success');

      } catch (error) {
        if (error.name === 'AbortError') {
          showResult('retryResult', `‚è∞ <strong>Timeout!</strong><br>
            La petici√≥n tard√≥ m√°s de 5 segundos<br><br>
            üí° Los timeouts evitan esperas infinitas`, 'warning');
        } else {
          showResult('retryResult', `‚ùå Error: ${error.message}`, 'error');
        }
      }
    }

    // Demo UI states
    async function demoUIStates() {
      const demo = document.getElementById('uiDemo');

      // Estado de carga
      demo.innerHTML = `
        <div class="flex items-center text-blue-400">
          <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-400 mr-3"></div>
          <span>Cargando datos...</span>
        </div>
      `;

      await new Promise(resolve => setTimeout(resolve, 2000));

      // Estado de error
      demo.innerHTML = `
        <div class="text-red-400 text-center">
          <div class="text-4xl mb-2">‚ö†Ô∏è</div>
          <div class="font-semibold">Error de conexi√≥n</div>
          <div class="text-sm text-red-300">No se pudo conectar al servidor</div>
          <button onclick="demoUIStates()" class="mt-3 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm transition-colors">
            Reintentar
          </button>
        </div>
      `;

      // Simular que despu√©s de un tiempo se arregla
      setTimeout(async () => {
        demo.innerHTML = `
          <div class="flex items-center text-blue-400">
            <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-400 mr-3"></div>
            <span>Reintentando...</span>
          </div>
        `;

        await new Promise(resolve => setTimeout(resolve, 1500));

        // Estado de √©xito
        demo.innerHTML = `
          <div class="text-green-400 text-center">
            <div class="text-4xl mb-2">‚úÖ</div>
            <div class="font-semibold">Datos cargados correctamente</div>
            <div class="text-sm text-green-300">3 elementos encontrados</div>
          </div>
        `;
      }, 3000);
    }

    // Demo sistema completo
    async function demoCompleteSystem() {
      showResult('completeResult', 'üöÄ Inicializando sistema robusto...', 'info');

      // Simular el APIClient
      class DemoAPIClient {
        constructor() {
          this.retries = 2;
          this.timeout = 3000;
        }

        async request(simulateError = false) {
          let lastError;

          for (let i = 0; i <= this.retries; i++) {
            try {
              showResult('completeResult', `üîÑ Intento ${i + 1} de ${this.retries + 1}...`, 'info');

              if (simulateError && i < this.retries) {
                throw new Error('Conexi√≥n temporalmente no disponible');
              }

              await new Promise(resolve => setTimeout(resolve, 1000));

              return {
                data: { message: 'Datos obtenidos exitosamente', timestamp: new Date().toISOString() },
                status: 200
              };

            } catch (error) {
              lastError = error;
              if (i < this.retries) {
                const delay = Math.pow(2, i) * 1000;
                showResult('completeResult', `‚ö†Ô∏è Intento ${i + 1} fall√≥. Reintentando en ${delay / 1000}s...`, 'warning');
                await new Promise(resolve => setTimeout(resolve, delay));
              }
            }
          }

          throw new Error(`Sistema fall√≥ despu√©s de ${this.retries + 1} intentos: ${lastError.message}`);
        }
      }

      try {
        const api = new DemoAPIClient();
        const result = await api.request(true); // Simular errores iniciales

        showResult('completeResult', `‚úÖ <strong>Sistema robusto funcionando!</strong><br><br>
          <strong>Caracter√≠sticas implementadas:</strong><br>
          ‚Ä¢ ‚úÖ Reintentos autom√°ticos<br>
          ‚Ä¢ ‚úÖ Manejo de timeouts<br>
          ‚Ä¢ ‚úÖ Mensajes de error amigables<br>
          ‚Ä¢ ‚úÖ Estados de carga visuales<br>
          ‚Ä¢ ‚úÖ Recuperaci√≥n autom√°tica de errores<br><br>
          <strong>Datos recibidos:</strong><br>
          <code>${JSON.stringify(result.data, null, 2)}</code>`, 'success');

      } catch (error) {
        showResult('completeResult', `‚ùå <strong>Error del sistema:</strong><br>
          ${error.message}<br><br>
          üí° Incluso con todas las medidas de seguridad, algunos errores pueden ocurrir.
          La clave es manejarlos graciosamente.`, 'error');
      }
    }

    // Animaciones al hacer scroll
    const observerOptions = {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.style.opacity = '1';
          entry.target.style.transform = 'translateY(0)';
        }
      });
    }, observerOptions);

    // Observar elementos para animaciones
    document.addEventListener('DOMContentLoaded', () => {
      const elements = document.querySelectorAll('.fade-in-up');
      elements.forEach(el => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(30px)';
        el.style.transition = 'opacity 0.8s ease-out, transform 0.8s ease-out';
        observer.observe(el);
      });
    });
  </script>
</body>

</html>